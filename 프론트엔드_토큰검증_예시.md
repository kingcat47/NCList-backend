# 프론트엔드 토큰 검증 예시 코드

## 1. API 서비스 설정

```typescript
// services/api.ts
import axios from 'axios';

const API_BASE_URL = 'http://localhost:3000'; // 백엔드 서버 주소

// axios 인스턴스 생성
const api = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
});

// 요청 인터셉터 - 토큰 자동 추가
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('accessToken'); // 또는 AsyncStorage
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 응답 인터셉터 - 토큰 만료 처리
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // 토큰이 만료되었거나 유효하지 않음
      localStorage.removeItem('accessToken');
      // 로그인 페이지로 리다이렉트
      // router.push('/login');
    }
    return Promise.reject(error);
  }
);

export default api;
```

## 2. 인증 관련 API 함수

```typescript
// services/auth.ts
import api from './api';

export interface SendVerificationResponse {
  message: string;
  phoneNumber: string;
}

export interface LoginResponse {
  accessToken: string;
  user: {
    id: string;
    phoneNumber: string;
    isVerified: boolean;
  };
}

export interface VerifyTokenResponse {
  message: string;
  user: {
    id: string;
    phoneNumber: string;
  };
}

export const authAPI = {
  // 인증 코드 전송
  sendVerification: async (phoneNumber: string): Promise<SendVerificationResponse> => {
    const response = await api.post('/auth/send-verification', { phoneNumber });
    return response.data;
  },

  // 인증 코드 확인 및 로그인
  login: async (phoneNumber: string, verificationCode: string): Promise<LoginResponse> => {
    const response = await api.post('/auth/verify-code', { phoneNumber, verificationCode });
    return response.data;
  },

  // 토큰 검증
  verifyToken: async (): Promise<VerifyTokenResponse> => {
    const response = await api.get('/auth/verify-token');
    return response.data;
  },
};
```

## 3. 앱 시작 시 토큰 검증

```typescript
// hooks/useAuth.ts
import { useState, useEffect } from 'react';
import { authAPI } from '../services/auth';

interface User {
  id: string;
  phoneNumber: string;
  isVerified: boolean;
}

export const useAuth = () => {
  const [user, setUser] = useState<User | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isAuthenticated, setIsAuthenticated] = useState(false);

  // 앱 시작 시 토큰 검증
  const checkAuth = async () => {
    try {
      const token = localStorage.getItem('accessToken');
      
      if (!token) {
        setIsAuthenticated(false);
        setUser(null);
        return;
      }

      // 토큰 검증 API 호출
      const response = await authAPI.verifyToken();
      
      // 토큰이 유효한 경우
      setIsAuthenticated(true);
      setUser({
        id: response.user.id,
        phoneNumber: response.user.phoneNumber,
        isVerified: true, // 토큰이 있으면 이미 인증된 사용자
      });
    } catch (error) {
      console.error('토큰 검증 실패:', error);
      // 토큰이 유효하지 않은 경우
      localStorage.removeItem('accessToken');
      setIsAuthenticated(false);
      setUser(null);
    } finally {
      setIsLoading(false);
    }
  };

  // 로그인 함수
  const login = async (phoneNumber: string, verificationCode: string) => {
    try {
      const response = await authAPI.login(phoneNumber, verificationCode);
      
      // 토큰 저장
      localStorage.setItem('accessToken', response.accessToken);
      
      // 사용자 정보 설정
      setUser(response.user);
      setIsAuthenticated(true);
      
      return response;
    } catch (error) {
      throw error;
    }
  };

  // 로그아웃 함수
  const logout = () => {
    localStorage.removeItem('accessToken');
    setUser(null);
    setIsAuthenticated(false);
  };

  // 앱 시작 시 토큰 검증 실행
  useEffect(() => {
    checkAuth();
  }, []);

  return {
    user,
    isLoading,
    isAuthenticated,
    login,
    logout,
    checkAuth,
  };
};
```

## 4. 앱 컴포넌트에서 사용

```typescript
// App.tsx 또는 _layout.tsx
import React from 'react';
import { useAuth } from './hooks/useAuth';
import LoginScreen from './screens/LoginScreen';
import MainScreen from './screens/MainScreen';
import LoadingScreen from './screens/LoadingScreen';

export default function App() {
  const { user, isLoading, isAuthenticated } = useAuth();

  // 로딩 중
  if (isLoading) {
    return <LoadingScreen />;
  }

  // 인증되지 않은 경우 로그인 화면
  if (!isAuthenticated) {
    return <LoginScreen />;
  }

  // 인증된 경우 메인 화면
  return <MainScreen user={user} />;
}
```

## 5. 로그인 화면 예시

```typescript
// screens/LoginScreen.tsx
import React, { useState } from 'react';
import { View, Text, TextInput, TouchableOpacity, Alert } from 'react-native';
import { useAuth } from '../hooks/useAuth';
import { authAPI } from '../services/auth';

export default function LoginScreen() {
  const [phoneNumber, setPhoneNumber] = useState('');
  const [verificationCode, setVerificationCode] = useState('');
  const [isCodeSent, setIsCodeSent] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  
  const { login } = useAuth();

  // 인증 코드 전송
  const handleSendCode = async () => {
    if (!phoneNumber) {
      Alert.alert('오류', '전화번호를 입력해주세요.');
      return;
    }

    setIsLoading(true);
    try {
      await authAPI.sendVerification(phoneNumber);
      setIsCodeSent(true);
      Alert.alert('성공', '인증 코드가 전송되었습니다.');
    } catch (error) {
      Alert.alert('오류', '인증 코드 전송에 실패했습니다.');
    } finally {
      setIsLoading(false);
    }
  };

  // 로그인
  const handleLogin = async () => {
    if (!verificationCode) {
      Alert.alert('오류', '인증 코드를 입력해주세요.');
      return;
    }

    setIsLoading(true);
    try {
      await login(phoneNumber, verificationCode);
      Alert.alert('성공', '로그인되었습니다.');
    } catch (error) {
      Alert.alert('오류', '인증 코드가 올바르지 않습니다.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <View style={{ flex: 1, padding: 20, justifyContent: 'center' }}>
      <Text style={{ fontSize: 24, fontWeight: 'bold', marginBottom: 30 }}>
        로그인
      </Text>
      
      <TextInput
        style={{ borderWidth: 1, borderColor: '#ddd', padding: 15, marginBottom: 15 }}
        placeholder="전화번호 (01012345678)"
        value={phoneNumber}
        onChangeText={setPhoneNumber}
        keyboardType="phone-pad"
      />
      
      <TouchableOpacity
        style={{ backgroundColor: '#007AFF', padding: 15, marginBottom: 15 }}
        onPress={handleSendCode}
        disabled={isLoading}
      >
        <Text style={{ color: 'white', textAlign: 'center' }}>
          {isLoading ? '전송 중...' : '인증 코드 전송'}
        </Text>
      </TouchableOpacity>

      {isCodeSent && (
        <>
          <TextInput
            style={{ borderWidth: 1, borderColor: '#ddd', padding: 15, marginBottom: 15 }}
            placeholder="인증 코드 6자리"
            value={verificationCode}
            onChangeText={setVerificationCode}
            keyboardType="number-pad"
            maxLength={6}
          />
          
          <TouchableOpacity
            style={{ backgroundColor: '#34C759', padding: 15 }}
            onPress={handleLogin}
            disabled={isLoading}
          >
            <Text style={{ color: 'white', textAlign: 'center' }}>
              {isLoading ? '로그인 중...' : '로그인'}
            </Text>
          </TouchableOpacity>
        </>
      )}
    </View>
  );
}
```

## 6. 보호된 라우트 예시

```typescript
// components/ProtectedRoute.tsx
import React from 'react';
import { useAuth } from '../hooks/useAuth';
import LoginScreen from '../screens/LoginScreen';

interface ProtectedRouteProps {
  children: React.ReactNode;
}

export default function ProtectedRoute({ children }: ProtectedRouteProps) {
  const { isAuthenticated, isLoading } = useAuth();

  if (isLoading) {
    return <div>로딩 중...</div>;
  }

  if (!isAuthenticated) {
    return <LoginScreen />;
  }

  return <>{children}</>;
}
```

## 사용법

1. **앱 시작 시**: `useAuth` 훅이 자동으로 토큰을 검증합니다.
2. **토큰이 유효한 경우**: 사용자는 자동으로 로그인된 상태가 됩니다.
3. **토큰이 없거나 만료된 경우**: 로그인 화면이 표시됩니다.
4. **로그인 성공 시**: 토큰이 저장되고 메인 화면으로 이동합니다.

이 코드를 사용하면 앱을 다시 열 때마다 자동으로 토큰을 검증하여 사용자 경험을 향상시킬 수 있습니다! 